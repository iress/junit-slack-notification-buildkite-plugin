version: "3"
services:
  slack-notification:
    image: ${BUILDKITE_PLUGIN_JUNIT_SLACK_NOTIFICATION_DOCKER_CACHE}node:21
    environment:
      SLACK_TOKEN: ${TOKEN_VALUE}
      SLACK_CHANNEL: ${BUILDKITE_PLUGIN_JUNIT_SLACK_NOTIFICATION_SLACK_CHANNEL}
      BUILDKITE_BUILD_NUMBER: ${BUILDKITE_BUILD_NUMBER}
      BUILDKITE_BUILD_URL: ${BUILDKITE_BUILD_URL}
      BUILDKITE_PIPELINE_NAME: ${BUILDKITE_PIPELINE_NAME}
      BUILDKITE_BRANCH: ${BUILDKITE_BRANCH}
      BUILDKITE_MESSAGE: ${BUILDKITE_MESSAGE}
      BUILDKITE_COMMIT: ${BUILDKITE_COMMIT}
      BUILDKITE_BUILD_AUTHOR: ${BUILDKITE_BUILD_AUTHOR}
      NPM_REGISTRY: ${NPM_REGISTRY}
      NPM_TOKEN: ${NPM_TOKEN}
      ARTIFACTS: ${BUILDKITE_PLUGIN_JUNIT_SLACK_NOTIFICATION_ARTIFACTS}
      TEST_SUITES_0_ARTIFACTS: ${BUILDKITE_PLUGIN_JUNIT_SLACK_NOTIFICATION_TEST_SUITES_0_ARTIFACTS}
      TEST_SUITES_0_NAME: ${BUILDKITE_PLUGIN_JUNIT_SLACK_NOTIFICATION_TEST_SUITES_0_NAME}
      TEST_SUITES_1_ARTIFACTS: ${BUILDKITE_PLUGIN_JUNIT_SLACK_NOTIFICATION_TEST_SUITES_1_ARTIFACTS}
      TEST_SUITES_1_NAME: ${BUILDKITE_PLUGIN_JUNIT_SLACK_NOTIFICATION_TEST_SUITES_1_NAME}
      TEST_SUITES_2_ARTIFACTS: ${BUILDKITE_PLUGIN_JUNIT_SLACK_NOTIFICATION_TEST_SUITES_2_ARTIFACTS}
      TEST_SUITES_2_NAME: ${BUILDKITE_PLUGIN_JUNIT_SLACK_NOTIFICATION_TEST_SUITES_2_NAME}
      TEST_SUITES_3_ARTIFACTS: ${BUILDKITE_PLUGIN_JUNIT_SLACK_NOTIFICATION_TEST_SUITES_3_ARTIFACTS}
      TEST_SUITES_3_NAME: ${BUILDKITE_PLUGIN_JUNIT_SLACK_NOTIFICATION_TEST_SUITES_3_NAME}
      TEST_SUITES_4_ARTIFACTS: ${BUILDKITE_PLUGIN_JUNIT_SLACK_NOTIFICATION_TEST_SUITES_4_ARTIFACTS}
      TEST_SUITES_4_NAME: ${BUILDKITE_PLUGIN_JUNIT_SLACK_NOTIFICATION_TEST_SUITES_4_NAME}
      TEST_SUITES_5_ARTIFACTS: ${BUILDKITE_PLUGIN_JUNIT_SLACK_NOTIFICATION_TEST_SUITES_5_ARTIFACTS}
      TEST_SUITES_5_NAME: ${BUILDKITE_PLUGIN_JUNIT_SLACK_NOTIFICATION_TEST_SUITES_5_NAME}
    command: /app/scripts/run.sh
    volumes:
      - $ARTIFACTS_DIR:/app/reports
      - .:/app
    working_dir: /app
    entrypoint: ["bash"]
  lint:
    image: buildkite/plugin-linter:latest
    command: ['--id', 'iress/junit-slack-notification']
    volumes:
      - ".:/plugin:ro"
  tests:
    image: buildkite/plugin-tester:latest
    volumes:
      - ".:/plugin:rw"
